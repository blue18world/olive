<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>迴避型依戀療癒生成器</title>
    
    <!-- 引入字體 -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@300;500&family=Noto+Sans+TC:wght@300&display=swap" rel="stylesheet">
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 引入 React 和 Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* 自定義字體設定 */
        body { font-family: 'Noto Serif TC', serif; }
        .sans { font-family: 'Noto Sans TC', sans-serif; }
    </style>
</head>
<body class="bg-[#F2EBE9]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // 圖標組件 (將 Lucide 圖標轉為內嵌 SVG 以便於單一檔案使用)
        const RefreshIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
        );
        const DownloadIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
        );
        const CopyIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
        );
        const CheckIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
        );

        const AvoidantAttachmentGenerator = () => {
            const [currentQuote, setCurrentQuote] = useState("");
            const [isAnimating, setIsAnimating] = useState(false);
            const [copied, setCopied] = useState(false);
            const canvasRef = useRef(null);

            const quotes = [
                "你的獨立很迷人，但適度的依賴，並不代表會失去自我。",
                "他在尋求確認，不是為了控制你，只是為了確認這段關係還安全。",
                "你需要空間充電，這沒問題。只要在轉身前，先給他一個具體的歸期。",
                "沈默是你的防護罩，但對他來說，卻是隨時會被拋棄的警報。",
                "愛不是要吞噬你的靈魂，而是兩個完整的人，選擇並肩同行。",
                "試著說出「我現在有點累，需要休息一下」，而不是直接消失。",
                "衝突不代表關係的毀滅，它只是溝通的一種激烈形式。",
                "他的焦慮，其實是在大聲說著「我很在乎你」。",
                "不要預設他會勒索你的情緒，試著去接住一次看看，你也許會發現自己比想像中強大。",
                "親密感不會讓你窒息，那是靈魂得以棲息的港灣。",
                "解釋並不是示弱，而是為了保護這段關係不被誤解。",
                "給予一點點安心的訊號，就能省去後面大段的爭吵。",
                "你不需要為他的情緒負責，但你可以陪著他經歷情緒。",
                "偶爾展現脆弱，也是一種強大的力量。",
                "逃避雖然有用，但這一次，試著留下來解決問題。",
                "真正的自由，是在親密關係裡依然能做真實的自己。",
                "別讓「怕麻煩」成為錯過深層連結的藉口。",
                "回應期待，不等於要犧牲邊界。",
                "他要的不是你的全部時間，而是你在的時候，心也在。",
                "慢下來，去感受連結，而不是急著分析利弊。",
                "不要等到準備好才去愛，愛是在互動中學會的。",
                "一句簡單的「我在」，勝過千言萬語的辯解。",
                "主動報備不是被監控，而是給予信任的邀請函。",
                "堅強太久會累，允許自己被接住一次吧。"
            ];

            useEffect(() => {
                generateQuote();
            }, []);

            const generateQuote = () => {
                setIsAnimating(true);
                setTimeout(() => {
                    const randomIndex = Math.floor(Math.random() * quotes.length);
                    setCurrentQuote(quotes[randomIndex]);
                    setIsAnimating(false);
                    setCopied(false);
                }, 300);
            };

            const handleCopy = () => {
                navigator.clipboard.writeText(currentQuote);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            const handleDownload = () => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                const size = 1080;
                
                canvas.width = size;
                canvas.height = size;

                // 背景
                ctx.fillStyle = '#F9F1F0'; 
                ctx.fillRect(0, 0, size, size);

                // 文字樣式
                ctx.fillStyle = '#6A2C39';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                // 字體
                const fontSize = 48;
                ctx.font = `500 ${fontSize}px "Noto Serif TC", "Songti TC", serif`;

                // 換行邏輯
                const text = currentQuote;
                const maxWidth = size * 0.7;
                const lineHeight = fontSize * 1.8;
                const words = text.split('');
                let line = '';
                let lines = [];

                for (let i = 0; i < words.length; i++) {
                    const testLine = line + words[i];
                    const metrics = ctx.measureText(testLine);
                    const testWidth = metrics.width;
                    if (testWidth > maxWidth && i > 0) {
                        lines.push(line);
                        line = words[i];
                    } else {
                        line = testLine;
                    }
                }
                lines.push(line);

                // 繪製
                const totalHeight = lines.length * lineHeight;
                let startY = (size - totalHeight) / 2 + (lineHeight / 2);

                lines.forEach((line, index) => {
                    ctx.fillText(line, size / 2, startY + index * lineHeight);
                });

                // 裝飾字
                ctx.font = `300 24px "Noto Sans TC", sans-serif`;
                ctx.fillStyle = '#8C5E66';
                ctx.fillText("Avoidant Attachment Healing Note", size / 2, size - 80);

                // 下載
                const link = document.createElement('a');
                link.download = `healing-note-${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4 font-serif">
                    <div className="max-w-md w-full flex flex-col items-center gap-8">
                        
                        <div className="text-center space-y-2">
                            <h1 className="text-[#6A2C39] text-xl tracking-[0.2em] font-light uppercase">
                                Inner Dialog
                            </h1>
                            <p className="text-[#8C5E66] text-xs tracking-widest sans">
                                給迴避依戀的溫柔備忘錄
                            </p>
                        </div>

                        <div className="relative group w-full aspect-square bg-[#F9F1F0] shadow-xl shadow-[#6A2C39]/5 flex items-center justify-center p-12 transition-all duration-700 ease-in-out">
                            <div className="absolute top-6 left-6 w-8 h-[1px] bg-[#6A2C39]/20"></div>
                            <div className="absolute top-6 left-6 h-8 w-[1px] bg-[#6A2C39]/20"></div>
                            <div className="absolute bottom-6 right-6 w-8 h-[1px] bg-[#6A2C39]/20"></div>
                            <div className="absolute bottom-6 right-6 h-8 w-[1px] bg-[#6A2C39]/20"></div>

                            <div className={`transition-opacity duration-500 ${isAnimating ? 'opacity-0' : 'opacity-100'}`}>
                                <p className="text-[#6A2C39] text-lg md:text-xl font-medium leading-loose tracking-widest text-center whitespace-pre-wrap">
                                    {currentQuote}
                                </p>
                            </div>
                        </div>

                        <div className="flex gap-6 items-center">
                            <button 
                                onClick={generateQuote}
                                className="group relative px-8 py-3 bg-[#6A2C39] text-[#F9F1F0] rounded-full shadow-lg hover:shadow-xl hover:bg-[#52222c] transition-all duration-300 flex items-center gap-2 sans"
                            >
                                <RefreshIcon className={`transition-transform duration-700 ${isAnimating ? 'rotate-180' : ''}`} />
                                <span className="tracking-widest text-sm">生成新語句</span>
                            </button>

                            <div className="flex gap-2">
                                <button 
                                    onClick={handleCopy}
                                    className="p-3 rounded-full bg-white text-[#6A2C39] shadow-sm hover:shadow-md hover:bg-[#FDF6F5] transition-all border border-[#F9F1F0]"
                                    title="複製文字"
                                >
                                    {copied ? <CheckIcon /> : <CopyIcon />}
                                </button>
                                <button 
                                    onClick={handleDownload}
                                    className="p-3 rounded-full bg-white text-[#6A2C39] shadow-sm hover:shadow-md hover:bg-[#FDF6F5] transition-all border border-[#F9F1F0]"
                                    title="下載圖片"
                                >
                                    <DownloadIcon />
                                </button>
                            </div>
                        </div>

                        <canvas ref={canvasRef} style={{ display: 'none' }} />
                        
                        <div className="text-[#8C5E66]/60 text-[10px] tracking-widest mt-4 sans">
                           DESIGNED FOR THE AVOIDANT
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AvoidantAttachmentGenerator />);
    </script>
</body>
</html>
